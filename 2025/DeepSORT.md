# Simple online and realtime tracking with a deep association metric

## 論文について (掲載ジャーナルなど)

- [Wojke, N., Bewley, A., & Paulus, D. (2017, September). Simple online and realtime tracking with a deep association metric. In 2017 IEEE international conference on image processing (ICIP) (pp. 3645-3649). IEEE.](https://arxiv.org/pdf/1703.07402)

## 概要

- 既存手法にSORTがある。SORTは、カルマンフィルタとハンガリアンアルゴリズムを用いたデータ間の関連付けを行う手法。
- SORTにはIDスイッチ（オクルージョンなどで追跡対象を見失う・誤った物体に関連付けを行うことで物体のIDが切り替わってしまう問題）がまだまだ多いという課題がある
- 上記課題を解決するためにCNNを用いて抽出した外見情報を用いて離れたフレーム間でもIDの割当できるように改良したのがDeepSORT

## 感想

- 思ってたよりも既存手法の上に積み上げられた技術という印象
  - SORT部分のアルゴリズムが「動いているカメラ＋人も動くという環境下で人物を追跡する問題」に対して特化したものになっていて、そもそもの性能が高いんやろな
- CNN部分を改良して、外見情報の重みを増せばもっと性能向上しそう
  - 抽出される特徴は光の当たり方に頑健とか物体の向きに頑健とかの条件が満たされていてほしい
- 人間がする洞察を組み込めたらもっとよくならないか？
  - 部分部分でマッチングしているか確認するチェックリストで何点以上ならOKみたいな
  - 上半身は赤い服きてる下半身はジーパンとか、茶色の長髪とか
  - 重要なポイントを特徴として抜き出すみたいな方法

## 論文読解プロンプト実行結果

追加された論文「SIMPLE ONLINE AND REALTIME TRACKING WITH A DEEP ASSOCIATION METRIC.pdf」に対して、論文読解プロンプトを実行します。

### 1. 論文のテーマと目的を要約

本論文のテーマは、**オンラインおよびリアルタイムでの複数物体追跡（Multiple Object Tracking, MOT）**において、既存のシンプルオンラインリアルタイムトラッキング（SORT）フレームワークを拡張し、**深い学習に基づく外観情報**を組み込むことで、追跡性能、特に**IDスイッチ（同一対象のIDが途中で変わってしまう現象）の数を大幅に削減する**ことです。

従来のSORTは、高速な処理が可能であるものの、物体の**遮蔽（オクルージョン）**が発生した際にIDの維持が困難であるという課題がありました。この課題を克服するために、本論文では、大規模な人物再識別データセットでオフライン学習された**深い関連性メトリック**を導入し、オンライン追跡時に**視覚的な外観空間での最近傍探索**を用いて測定とトラックの関連付けを行う手法を提案しています。

論文の目的は、SORTのシンプルさと効率性を維持しつつ、外観情報を活用することで、より**ロバストな追跡**、特に**長期間の遮蔽後のID維持**を実現することです。実験評価では、提案手法がIDスイッチの数を大幅に削減し、全体的に競争力のある性能を高速なフレームレートで達成することが示されています。論文では、提案手法のコードと事前学習済みのCNNモデルを公開し、研究実験と実用的なアプリケーション開発を促進することも目的としています。

提案手法が必要になるまでのストーリーとして、論文ではまず、近年の物体検出の進展により、追跡は検出結果に基づいて行われる「tracking-by-detection」というパラダイムが主流になったことを説明しています。しかし、従来のバッチ処理を行うグローバル最適化手法はオンラインシナリオには適用できず、オンライン手法であるMHTやJPDAFは計算量や実装の複雑さが増すという課題がありました。そこで、シンプルで高速なSORTが登場しましたが、遮蔽に弱いという欠点がありました。この背景を踏まえ、SORTに外観情報を組み込むことで、オンライン性とロバスト性を両立させる必要性が示されています。

### 2. 論文のセクション構成を分析

- **1. INTRODUCTION**: 多物体追跡の背景、tracking-by-detectionパラダイム、既存手法の課題、SORTの概要と課題、本研究の提案とその貢献について述べています。
- **2. SORT WITH DEEP ASSOCIATION METRIC**: 提案手法の核となる要素について詳細に説明しています。
  - **2.1. Track Handling and State Estimation**: Kalmanフィルタを用いたトラックの管理と状態推定について、元のSORTと同様の手法を説明しています。カメラのキャリブレーションや自己運動の情報がない一般的なシナリオを想定している点が述べられています。
  - **2.2. Assignment Problem**: 予測されたKalman状態と新しい測定との関連付け問題を解くための手法を説明しています。**運動情報に基づくMahalanobis距離**と、**外観情報に基づくコサイン距離**を組み合わせた関連性メトリックを導入し、ハンガリアンアルゴリズムを用いて最適な割り当てを見つける方法が述べられています。
  - **2.3. Matching Cascade**: グローバルな割り当て問題を解く代わりに、**マッチングカスケード**という一連のサブ問題を解くアプローチを提案しています。これは、より頻繁に観測されているオブジェクトを優先することで、長期遮蔽後の追跡性能を向上させるための工夫です。
  - **2.4. Deep Appearance Descriptor**: 外観特徴を抽出するために用いる**Convolutional Neural Network (CNN)**のアーキテクチャについて説明しています。大規模な人物再識別データセットで事前学習されたネットワークを使用し、抽出された特徴はコサイン距離による比較に適するように正規化されることが述べられています。
- **3. EXPERIMENTS**: MOT16ベンチマークデータセットを用いた実験結果について報告しています。評価プロトコル、パラメータ設定、他の手法との比較などが示されています。
- **4. CONCLUSION**: 本研究の成果と貢献を改めて述べ、提案手法の有効性と今後の可能性について concluding remarks を述べています。
- **5. REFERENCES**: 参考文献リストです。

### 3. 重要なキーワードと概念を抽出

- **Multiple Object Tracking (MOT)**
- **Tracking-by-detection**
- **Simple Online and Realtime Tracking (SORT)**
- **Identity Switch (ID)**
- **Occlusion (遮蔽)**
- **Deep Association Metric (深い関連性メトリック)**
- **Appearance Information (外観情報)**
- **Kalman Filter (カルマンフィルタ)**
- **Hungarian Algorithm (ハンガリアンアルゴリズム)**
- **Mahalanobis Distance (マハラノビス距離)**
- **Cosine Distance (コサイン距離)**
- **Matching Cascade (マッチングカスケード)**
- **Convolutional Neural Network (CNN)**
- **Person Re-identification (人物再識別)**
- **MOT16 Benchmark**
- **MOTA (Multi-object tracking accuracy)**
- **MOTP (Multi-object tracking precision)**
- **Mostly Tracked (MT)**
- **Mostly Lost (ML)**
- **Fragmentation (FM)**
- **False Positive (FP)**
- **False Negative (FN)**

### 4. 図表の意味と役割を説明

- **Figure 1**: MOTチャレンジデータセットにおける一般的な追跡状況（頻繁な遮蔽が発生する場面）での提案手法の出力例を示しています。これにより、提案手法が遮蔽下でも適切にオブジェクトを追跡し、IDを維持できている様子を視覚的に示しています。
- **Table 1**: 提案手法で用いられる**CNNのアーキテクチャ**の概要を示しています。各層の名前、パッチサイズ/ストライド、出力サイズが記載されており、最終的な特徴マップが128次元であり、バッチ正規化とL2正規化によって単位超球面に射影されることが説明されています。この表は、外観特徴抽出の具体的なネットワーク構造を理解する上で重要です。
- **Table 2**: MOT16チャレンジにおける提案手法（Deep SORT (Ours)）と他の公開されている手法との追跡結果の比較を示しています。MOTA、MOTP、MT、ML、ID、FM、FP、FN、Runtimeなどの評価指標が比較されており、提案手法が特に**IDスイッチの数（ID）において他のオンライン手法と比較して最も少ない**ことが示されています。また、SORTと比較してIDスイッチが大幅に減少していることも示されており、提案手法の有効性を定量的に評価する上で重要な情報を提供しています。

### 5. 質問リストの各質問を分析（想定）

- **質問1**: 従来のSORTではなぜIDスイッチが多く発生するのですか？
  - **意図**: 提案手法が解決しようとしている根本的な問題を理解したい。
  - **関連箇所**: 導入、2.2 Assignment Problem。
- **質問2**: 提案手法では、運動情報と外観情報をどのように組み合わせて関連付けを行っているのですか？
  - **意図**: 提案手法の主要な技術的貢献を理解したい。
  - **関連箇所**: 2.2 Assignment Problem。
- **質問3**: マッチングカスケードは、IDスイッチの削減にどのように貢献するのですか？
  - **意図**: 提案手法のユニークな要素であるマッチングカスケードの役割を理解したい。
  - **関連箇所**: 2.3 Matching Cascade。
- **質問4**: 外観特徴抽出に用いられているCNNは、どのようなデータセットで学習されたのですか？
  - **意図**: 外観特徴の汎化性能や適用範囲を理解したい。
  - **関連箇所**: 2.4 Deep Appearance Descriptor。
- **質問5**: 実験結果から、提案手法の具体的な性能向上はどの程度と言えますか？
  - **意図**: 提案手法の有効性を定量的に把握したい。
  - **関連箇所**: 3. EXPERIMENTS、Table 2。
- **質問6**: 提案手法の計算コストはどの程度ですか？リアルタイムでの利用は可能ですか？
  - **意図**: 提案手法の実用性を評価したい。
  - **関連箇所**: 2.4 Deep Appearance Descriptor、3. EXPERIMENTS。

### 6. 各質問に対する回答を生成（想定）

- **質問1**: 従来のSORTではなぜIDスイッチが多く発生するのですか？
  - **回答**: 従来のSORTは、主に**bounding boxの重複度合い（IoU: Intersection over Union）**を基に関連付けを行っており、**物体の外観情報**を考慮していません。そのため、遮蔽などによって一時的に物体が検出されなくなった後、再び検出された際に、外観が似た別の物体と誤って関連付けられてしまい、IDスイッチが発生しやすくなります。また、SORTが用いる関連性メトリックは、**状態推定の不確実性が低い場合にのみ正確**であるため、遮蔽によって不確実性が高まると性能が低下します。
- **質問2**: 提案手法では、運動情報と外観情報をどのように組み合わせて関連付けを行っているのですか？
  - **回答**: 提案手法では、運動情報として**予測されたKalman状態と新しい測定との間のマハラノビス距離**、外観情報として**検出されたbounding boxから抽出された外観記述子と、トラックの過去の外観記述子のギャラリーとの間の最小コサイン距離** を用いています。これらの二つの距離を**重み付き和**として組み合わせたコスト関数 を定義し、そのコストに基づいて、**ハンガリアンアルゴリズム**を用いて最適な測定とトラックの割り当てを行います。さらに、各距離に対して**閾値**を設定し、両方の閾値を満たす関連付けのみを許容する**ゲーティング**という仕組みも導入しています。
- **質問3**: マッチングカスケードは、IDスイッチの削減にどのように貢献するのですか？
  - **回答**: マッチングカスケードは、**トラックの経過時間（最後に成功した関連付けからのフレーム数）**に基づいて、関連付けの優先順位をつける仕組みです。より最近観測されたトラックを優先的に関連付けることで、**長期にわたって遮蔽されていたトラック**は、状態推定の不確実性が増大しているため、関連付けの優先度が低くなります。これにより、不確実性の高い状態で無理に関連付けを行うことを避け、**誤った関連付け、ひいてはIDスイッチの発生を抑制**します。最終段階では、未確認のトラックや最近出現したトラックに対して、IoUに基づく関連付けを行うことで、突然の外観変化や誤った初期化に対するロバスト性を高めています。
- **質問4**: 外観特徴抽出に用いられているCNNは、どのようなデータセットで学習されたのですか？
  - **回答**: 外観特徴抽出に用いられているCNNは、**1,261人の歩行者の1,100,000枚以上の画像を含む大規模な人物再識別データセット** で事前学習されています。このデータセットは、人物追跡のコンテキストにおける深い距離学習に適しており、学習済みのネットワークを用いることで、オンライン追跡時に追加の距離学習を行うことなく、高い識別力を持つ外観特徴を抽出することが可能になります。
- **質問5**: 実験結果から、提案手法の具体的な性能向上はどの程度と言えますか？
  - **回答**: MOT16ベンチマークにおける実験結果（Table 2）によると、提案手法（Deep SORT (Ours)）は、従来のSORTと比較して**IDスイッチの数を1423から781へと約45%削減**しています。また、**Mostly Tracked (MT)** の割合も向上し、**Mostly Lost (ML)** の割合も減少しており、**長期間の遮蔽後もIDを維持する能力が向上**していることが示唆されています。一方、**False Positive (FP)** の数は増加していますが、全体として**オンライン追跡手法の中で最も少ないIDスイッチ数**を達成しつつ、競争力のあるMOTAスコアを維持しています。
- **質問6**: 提案手法の計算コストはどの程度ですか？リアルタイムでの利用は可能ですか？
  - **回答**: 論文中では、提案手法の**実装は約20 Hzで動作**し、そのうち約半分の時間が特徴量生成に費やされると述べられています。Nvidia GeForce GTX 1050 mobile GPUを用いた場合、**32個のbounding boxに対する1回のforward passは約30ms**であり、**現代的なGPU**が利用可能であれば、システムは**計算効率が高く、リアルタイムでの動作が可能**であると結論付けられています。

### 7. 論文の論理構造の分析

1.  **問題提起**: 既存のオンラインリアルタイム追跡手法（SORT）は高速だが、遮蔽に弱くIDスイッチが多い。
2.  **提案**: SORTに深い学習に基づく外観情報を取り入れることで、遮蔽に対するロバスト性を向上させ、IDスイッチを削減する。
3.  **手法**:
    - Kalmanフィルタによる状態推定とトラック管理（SORTと同様）。
    - 運動情報（マハラノビス距離）と外観情報（コサイン距離）を組み合わせた関連性メトリック。
    - より最近観測されたトラックを優先するマッチングカスケードによる関連付け。
    - 大規模な人物再識別データセットで事前学習されたCNNによる外観特徴抽出。
4.  **実験**: MOT16ベンチマークデータセットを用いて提案手法を評価し、既存手法と比較。
5.  **結果**: 提案手法はSORTと比較してIDスイッチを大幅に削減し、他のオンライン手法と比較しても競争力のある性能を示す。
6.  **結論**: 外観情報の導入により、オンラインリアルタイム追跡においてロバストなID維持が可能になった。

### 8. 参考文献の分析

参考文献リストを見ると、本論文は主に以下の研究分野に基づいていることがわかります。

- **Multiple Object Tracking (MOT)**: 複数物体追跡の基本的な手法やベンチマークに関する研究。
- **Tracking-by-detection**: 検出結果に基づいた追跡に関する研究。
- **Online Tracking**: オンラインでの追跡を可能にするための手法（SORTを含む）。
- **Data Association**: 検出とトラックの関連付けに関する研究（MHT, JPDAF, ネットワークフローなど）。
- **Deep Learning for Computer Vision**: 特に物体検出（Faster R-CNN）や人物再識別（MARS、Wide Residual Networks）に関する深い学習モデルの研究。

本論文の貢献は、既存の高速なオンライン追跡フレームワークであるSORT を基盤としつつ、近年発展の著しい**深層学習による外観特徴抽出**と、**マッチングカスケード**という効率的な関連付け戦略を組み合わせることで、**オンライン性と高いID維持性能**を両立させた点にあると言えます。特に、大規模な人物再識別データセットで学習されたネットワークを利用することで、オンライン追跡時に追加の学習を必要とせず、汎用性の高い外観特徴を活用している点が重要です。

### 9. 関連研究との比較

Table 2 に示されているように、提案手法（Deep SORT）は、他のオンライン追跡フレームワーク（EAMTT、POI、SORT）と比較して、**最も少ないIDスイッチ数（ID）**を達成しています。これは、提案手法が外観情報を効果的に活用し、遮蔽などの影響を受けにくい安定した追跡を実現していることを示しています。

一方で、**MOTAスコア**は他の手法と比較して同程度またはやや低い場合があります。論文中では、これは主に**False Positive (FP)** の数の増加に起因する可能性が指摘されています。静的な背景での誤検出などが、比較的長い最大トラック寿命のために既存のトラックに結合されやすいことが原因として考えられています。

バッチ処理を行う手法（BATCHと記載された手法）は一般的に高いMOTAスコアを示す傾向がありますが、オンライン処理には適していません。提案手法はオンライン処理でありながら、バッチ処理に近いID維持性能を実現している点が特筆されます。

### 10. 回答の評価

上記の各回答は、対応する質問（想定）に対して、論文の内容に基づいて正確かつ詳細な情報を提供していると考えられます。論文中の具体的な記述や図表の内容も適宜参照しており、専門用語についても分かりやすく説明するように努めました。

### 11. 提案手法の全体概要と詳細説明

- **全体概要**: Deep SORTは、高速なオンライン複数物体追跡フレームワークであるSORTを拡張し、深い学習に基づく外観情報を統合することで、IDスイッチの数を大幅に削減する手法です。Kalmanフィルタによる状態推定、運動情報と外観情報を組み合わせた関連性メトリック、マッチングカスケードによる効率的な関連付け、事前学習済みCNNによる外観特徴抽出を主な要素としています。

- **詳細説明**:
  1.  **トラック処理と状態推定**: 各オブジェクトの追跡状態は、bounding boxの中心位置、アスペクト比、高さ、およびそれらの速度を含む8次元の状態で表現され、Kalmanフィルタによって予測および更新されます。トラックが最後に成功した測定と関連付けられてからの経過フレーム数は、トラックの「寿命」として管理され、最大寿命を超えたトラックはシーンから離れたとみなされます。新しい検出は、既存のトラックと関連付けられなかった場合に、初期の数フレームは「仮のトラック」として扱われます。
  2.  **割り当て問題**: 予測されたKalman状態と新しい測定との関連付けは、運動情報に基づくマハラノビス距離 と、外観情報に基づくコサイン距離 を組み合わせたコスト関数を用いて行われます。関連付けが許容されるかどうかは、それぞれの距離が適切な閾値内にあるかどうかで判断されます。最適な関連付けはハンガリアンアルゴリズムによって見つけられます。
  3.  **マッチングカスケード**: トラックの寿命に基づいて関連付けの優先順位をつけるマッチングカスケードが導入されています。より最近観測されたトラックが優先的に関連付けられ、長期遮蔽されたトラックは後回しにされます。これにより、状態推定の不確実性が高いトラックとの誤った関連付けを防ぎます。
  4.  **深い外観記述子**: 各bounding boxの外観特徴は、大規模な人物再識別データセットで事前学習されたCNNによって抽出されます。抽出された128次元の特徴ベクトルは、コサイン距離での比較に適するようにL2正規化されます。

### 12. 提案手法の優位な点と批判されるべき点

- **優位な点**:

  - 従来のSORTと比較して、**IDスイッチの数を大幅に削減**できる。
  - **長期間の遮蔽後でも、オブジェクトのIDを維持する能力が高い**。
  - 深い学習による外観情報を用いることで、**外観が類似したオブジェクト間の区別が向上**する。
  - **オンラインおよびリアルタイムでの処理が可能**である。
  - 実装が比較的シンプルであり、**現代的なGPUがあれば効率的に動作**する。

- **批判されるべき点**:
  - SORTと比較して、**トラックの断片化（Fragmentation）がわずかに増加**する傾向がある。これは、遮蔽下でもIDを維持しようとするため、一時的に検出が途切れた場合に新しいトラックとして再開されるのを防ぐためと考えられます。
  - MOTAスコアにおいては、**False Positive (FP) の増加**により、他の手法と比較して同程度またはやや低い場合がある。これは、比較的長い最大トラック寿命のために、静的な背景での誤検出などが既存のトラックに結合されやすいことが原因として示唆されています。
  - 外観特徴抽出のために**GPUが必要**であり、計算リソースが限られた環境では利用が難しい可能性がある。
  - **事前学習されたCNNの性能**に大きく依存するため、学習データと異なるドメインのオブジェクトに対しては性能が低下する可能性がある。

以上が、追加された論文「SIMPLE ONLINE AND REALTIME TRACKING WITH A DEEP ASSOCIATION METRIC.pdf」に対する論文読解プロンプトの実行結果です。

## 追加質問

    DeepSORTのアルゴリズムについて段階的に詳しく記述して。

DeepSORT（SIMPLE ONLINE AND REALTIME TRACKING WITH A DEEP ASSOCIATION METRIC）アルゴリズムは、SORT（Simple Online and Realtime Tracking）に外観情報を組み込むことで性能を向上させた手法です。特に、オクルージョン期間中のオブジェクト追跡能力を高め、IDスイッチの数を効果的に削減することを目的としています。

DeepSORTのアルゴリズムは、従来の単一仮説追跡手法に基づき、再帰的なカルマンフィルタリングとフレームごとのデータ関連付けを行います。以下にその主要な構成要素と段階を詳しく説明します。

1.  **トラックハンドリングと状態推定 (Track Handling and State Estimation)**

    - 元のSORT のフレームワークとほぼ同じです。
    - 追跡シナリオは、非キャリブレーションカメラで自己運動情報がない一般的な状況を想定しています。
    - オブジェクトの状態は、8次元の状態空間 `(u, v, γ, h, ẋ, ẏ, γ̇, ḣ)` で定義されます。これは、バウンディングボックスの中心位置 `(u, v)`、アスペクト比 `γ`、高さ `h`、およびそれぞれの画像座標での速度を含みます。
    - **カルマンフィルタ**を使用し、一定速度運動モデルと線形観測モデルを仮定します。観測値としては、バウンディングボックス座標 `(u, v, γ, h)` をオブジェクト状態の直接観測として使用します。
    - 各トラック `k` について、最後に正常に計測値が関連付けられてからのフレーム数 `ak` をカウントします。これはカルマンフィルタの予測中に増加し、計測値が関連付けられたときに0にリセットされます。
    - 事前に定義された最大寿命 `Amax` を超えたトラックはシーンを離れたと見なされ、トラックセットから削除されます。
    - 既存のトラックに関連付けられない各検出に対して、新しいトラック候補が開始されます。これらの新しいトラックは、最初の3フレームの間は「仮定 (tentative)」として分類されます。この期間中に、各タイムステップで正常な計測値の関連付けが期待されます。最初の3フレーム以内に計測値に正常に関連付けられないトラックは削除されます。

2.  **割り当て問題 (Assignment Problem)**

    - 予測されたカルマン状態と新しく到着した計測値の間の関連付けを解決するために、ハンガリアンアルゴリズムを使用して解決できる割り当て問題を構築します。
    - この問題には、動きと外観情報の両方が組み込まれます。
    - **動き情報の組み込み**:
      - 予測されたカルマン状態と新しく到着した計測値の間の（二乗）**マハラノビス距離 `d(1)`** を使用します。
      - マハラノビス距離は、状態推定の不確実性を考慮し、検出が平均トラック位置から何標準偏差離れているかを測定します。
      - このメトリックを使用して、逆χ2分布から計算された95%信頼区間でのマハラノビス距離を閾値処理することにより、ありそうもない関連付けを除外できます。これはバイナリ変数 `b(1)i,j` で示されます。4次元の計測空間では、対応するマハラノビス閾値は `t(1) = 9.4877` です。
      - ただし、画像空間での問題設定では、カルマンフィルタリングフレームワークから得られる予測された状態分布はオブジェクト位置の粗い推定にすぎません。特に、考慮されていないカメラの動きは画像平面で急速な変位を引き起こす可能性があり、これによりマハラノビス距離はオクルージョンを介した追跡にはあまり情報量の多いメトリックではなくなります。
    - **外観情報の組み込み**:
      - 各バウンディングボックス検出 `dj` に対して、外観記述子 `rj` （ノルムが1）を計算します。
      - 各トラック `k` について、最後の `Lk = 100` 件の関連付けられた外観記述子のギャラリー `Rk` を保持します。
      - 2番目のメトリックとして、外観空間での `i` 番目のトラックと `j` 番目の検出の間の最小**コサイン距離 `d(2)`** を測定します。これは `min{1− rj T r(i)k | r(i)k ∈ Ri}` で計算されます。
      - このメトリックに関しても、関連付けが許容可能かどうかを示すバイナリ変数 `b(2)i,j` を導入します。適切な閾値 `t(2)` は別途トレーニングデータセットで決定されます。
      - 実際には、事前学習済みのCNNを使用してバウンディングボックスの外観記述子を計算します。
    - **両メトリックの組み合わせ**:
      - 動き情報を提供するマハラノビス距離は短期予測に特に役立ち、外観情報を提供するコサイン距離は長期オクルージョン後にIDを回復するのに特に役立つことで、両方のメトリックが互いを補完します。
      - 関連付け問題の構築には、両メトリックを重み付き合計 `ci,j = λ d(1)(i, j) + (1− λ)d(2)(i, j)` を使用して組み合わせます。
      - 関連付けは、両方のメトリックのゲーティング領域内にある場合（`bi,j = b(1)i,j · b(2)i,j > 0`）に許容可能と見なされます。
      - ハイパーパラメータ `λ` によって、組み合わせられた関連付けコストに対する各メトリックの影響を制御できます。カメラの動きが大きい場合は `λ = 0` が合理的な選択肢であり、この設定では関連付けコスト項に外観情報のみが使用されますが、マハラノビスゲートはカルマンフィルタによって推測された可能なオブジェクト位置に基づいて実行不可能な割り当てを除外するために依然として使用されます。

3.  **マッチングカスケード (Matching Cascade)**

    - グローバルな割り当て問題として解決する代わりに、一連のサブ問題を解決するカスケードを導入します。
    - これは、オブジェクトが長期間オクルージョンされると、カルマンフィルタの予測によってオブジェクト位置に関連付けられた不確実性が増加するという問題に対処するためです。マハラノビス距離はより大きな不確実性を優先する傾向があり、トラックの断片化や不安定化を引き起こす可能性があるため、より頻繁に観測されている（寿命の若い）オブジェクトに優先順位を付けます。
    - アルゴリズムの概要はListing 1に示されています。
    - 入力はトラック `T` と検出 `D` のインデックスセット、および最大寿命 `Amax` です。
    - 関連付けコスト行列 `C` と許容可能な関連付けの行列 `B` を計算します。
    - トラックの寿命 `n` にわたってイテレーションし、寿命が増加するトラックに対する線形割り当て問題を解決します。
    - 寿命 `n` のトラック `Tn` （過去 `n` フレームで検出に関連付けられていないトラック）を選択します。
    - `Tn` のトラックと、まだ関連付けられていない検出 `U` の間の線形割り当てを解決します。
    - マッチのセット `M` と、まだ関連付けられていない検出 `U` を更新します。
    - このマッチングカスケードは、寿命の小さいトラック、つまりより最近観測されたトラックに優先順位を付けます。

4.  **最終マッチング段階**

    - マッチングカスケードの後、元のSORTアルゴリズム で提案されているIoU（Intersection over Union）関連付けを、確認されていない寿命 `n=1` のトラックとまだ関連付けられていない検出のセットに対して実行します。
    - これにより、静的シーンジオメトリによる部分的なオクルージョンなど、突然の外観変化を考慮し、誤った初期化に対する堅牢性を高めます。

5.  **ディープ外観記述子 (Deep Appearance Descriptor)**
    - DeepSORTでは、オフラインでトレーニングされた弁別性の高い特徴埋め込みが必要です。
    - 大規模な人物再識別データセット でトレーニングされた**畳み込みニューラルネットワーク（CNN）**を採用しています。このデータセットには1,261人の歩行者の1,100,000を超える画像が含まれており、人物追跡における深層メトリック学習に適しています。
    - CNNアーキテクチャはTable 1に示されています。概要として、2つの畳み込み層と6つのResidualブロックを備えたWide Residual Network を使用しています。
    - グローバル特徴マップ（次元128）はDense Layer 10で計算されます。最終的なバッチ正規化とL2正規化により、特徴は単位超球面に投影され、コサイン外観メトリックと互換性を持たせます。
    - ネットワークは合計2,800,864個のパラメータを持ち、32個のバウンディングボックスの1回の順伝播は約30msかかります（Nvidia GeForce GTX 1050モバイルGPUの場合）。このため、現代のGPUがあればオンライン追跡に適しています。事前学習済みモデルはGitHubリポジトリで公開されています。

これらのステップを組み合わせることで、DeepSORTは動きと外観情報の両方を利用して、より正確でロバストなオブジェクト追跡、特に長期間のオクルージョンを介したID維持を実現しています。

---

    DeepSORTは既存手法とどう異なるか？

DeepSORT（SIMPLE ONLINE AND REALTIME TRACKING WITH A DEEP ASSOCIATION METRIC）は、その名の通り、既存のSORT（Simple Online and Realtime Tracking）手法をベースにしており、主な違いは**外観情報（appearance information）**を追跡プロセスに組み込んでいる点です。

DeepSORTがSORTを含む既存手法と異なる点は主に以下の通りです。

1.  **外観情報の導入**:

    - 元のSORTは、主にバウンディングボックスの重なり（IoU）に基づくシンプルな関連付けメトリックを使用していました。これは状態推定の不確実性が低い場合には効果的ですが、**オクルージョンなどでオブジェクトが見えなくなった期間の追跡に弱く、アイデンティティスイッチが多く発生**するという欠点がありました。
    - DeepSORTは、この問題を克服するために**外観情報を追跡アルゴリズムに統合**しました。これにより、**より長い期間のオクルージョンを通じてオブジェクトを追跡できるようになり、結果としてアイデンティティスイッチの数を効果的に削減**します。

2.  **外観情報の取得**:

    - DeepSORTでは、オブジェクト（特に人物）の**外観情報**を表現するために、**深層学習モデル（畳み込みニューラルネットワーク、CNN）**を利用します。このCNNは、大規模な人物再識別データセットで**オフラインで事前学習**されています。
    - オンライン追跡時には、検出されたオブジェクトのバウンディングボックス画像から、この事前学習されたCNNを用いて**128次元の外観記述子（特徴ベクトル）**を計算します。

3.  **データ関連付けメトリックの強化**:

    - DeepSORTの関連付け問題では、SORTが用いていたような動き情報（バウンディングボックスの重なり）だけでなく、この**外観情報も組み合わせて**使用します。
    - 具体的には、予測されたカルマン状態と新しい検出の間の**動き情報を示すマハラノビス距離** と、トラックが保持する過去の外観記述子のギャラリーと新しい検出の外観記述子の間の**外観情報を示す最小コサイン距離** を組み合わせたコスト関数を使用します。
    - これにより、動き情報が不明瞭になる長期のオクルージョン後でも、外観の類似性に基づいて正しい関連付けを行うことが可能になります。関連付けは、両方のメトリックが許容可能な範囲（ゲーティング領域）にある場合にのみ有効と判断されます。

4.  **マッチングカスケードの導入**:
    - DeepSORTは、関連付け問題を単一のグローバルな割り当て問題として解くのではなく、**一連のサブ問題を解決するカスケード**を導入しています。
    - このカスケードは、**より若い（最近観測された）トラックに優先順位を与えて**関連付けを行います。これは、長期オクルージョンで不確実性が増したトラックが不適切に関連付けられることを防ぎ、トラックの断片化や不安定化を軽減するためです。
    - カスケードの最終段階では、確認されていない特定の寿命のトラックとまだ関連付けられていない検出に対して、**元のSORTで提案されていたIoUによる関連付け**も実行されます。これは、静的なシーンジオメトリによる部分的なオクルージョンなど、突然の外観変化に対応するのに役立ちます。

これらの改良により、DeepSORTはSORTのシンプルさ、効率性、オンラインでリアルタイムに動作できるという利点 を維持しつつ、特に**アイデンティティスイッチの数を大幅に削減**し（実験では約45%削減）、**オクルージョンに対する追跡のロバスト性を向上**させています。DeepSORTは、他のオンライン追跡フレームワークと比較しても、特にアイデンティティスイッチ数の点で競争力のある性能を示しています。

要約すると、DeepSORTはSORTを基盤としつつ、**深層学習による外観情報**と、それを活用するための**改良されたデータ関連付けメトリック（マハラノビス距離とコサイン距離の組み合わせ）**、そして**マッチングカスケード**を導入することで、特にオクルージョン状況下での追跡性能とアイデンティティ維持能力を大幅に向上させた手法であると言えます。
